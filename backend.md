# ☕ NADA COFFEE - Backend Architecture

나다커피(NADA COFFEE)의 백엔드 시스템은 안정적인 이커머스 운영을 위해 **확장성(Scalability)**과 **데이터 무결성(Data Integrity)**을 최우선으로 설계되었습니다.

---

## 🛠️ 기술 스택 (Tech Stack)

| 분류 | 기술 | 설명 |
| :--- | :--- | :--- |
| **Framework** | **Node.js + Express** | 비동기 I/O 처리에 최적화된 고성능 서버 프레임워크 |
| **Database** | **MySQL (Prisma ORM)** | 관계형 데이터베이스 및 타입 안전성을 보장하는 ORM 사용 |
| **Authentication** | **JWT (JSON Web Token)** | Stateless한 인증 방식으로 확장성 확보 |
| **Payment** | **Toss Payments SDK** | 안정적이고 간편한 결제 연동 |
| **Storage** | **AWS S3 (Multer)** | 상품 이미지 및 리뷰 사진 저장을 위한 클라우드 스토리지 |

---

## 📊 데이터베이스 설계 (ERD 요약)

핵심 비즈니스 로직을 지탱하는 8개의 주요 엔티티로 구성되어 있습니다.

1. **Users (회원)**: 고객 정보 및 등급(SILVER, GOLD, VIP) 관리
2. **Products (상품)**: 카테고리별 상품 정보, 재고, 옵션 관리
3. **Orders (주문)**: 주문 상태(결제대기~구매확정), 배송 정보, 결제 금액 관리
4. **OrderItems (주문상세)**: 주문별 상품 스냅샷(가격 변동 대응) 저장
5. **Carts (장바구니)**: 회원별 장바구니 아이템 영구 저장 (Redis 대신 DB 사용으로 데이터 보존)
6. **Reviews (리뷰)**: 상품별 평점 및 포토 리뷰 관리
7. **Points (포인트)**: 적립/사용 내역 히스토리 관리 (무결성 보장)
8. **Categories (카테고리)**: 계층형(Tree) 카테고리 구조 지원

---

## 🔑 핵심 API 구조 (Key APIs)

### 1. 주문 및 결제 (Order & Payment)
- **트랜잭션 처리**: 주문 생성 시 재고 차감과 포인트 사용이 동시에 이루어지도록 트랜잭션(Transaction)으로 묶어 데이터 정합성을 보장합니다.
- **검증 로직**: 프론트엔드에서 전달된 결제 금액과 서버에서 계산한 금액을 비교하여 위변조를 방지합니다.
- **0원 결제 최적화**: 전액 포인트 사용 시 PG사를 거치지 않고 즉시 주문을 완료 처리하는 별도 로직을 구현했습니다.

### 2. 상품 및 재고 관리 (Product & Inventory)
- **동시성 제어**: 다수의 사용자가 동시에 주문할 때 재고가 마이너스가 되지 않도록 낙관적 락(Optimistic Lock) 또는 DB 수준의 락을 고려하여 설계되었습니다.
- **통계 집계**: 관리자 대시보드를 위해 `GROUP BY`와 `SUM` 쿼리를 활용하여 실시간 매출 및 판매량 통계를 산출합니다.

### 3. 인증 및 권한 (Auth & RBAC)
- **Role-Based Access Control**: `USER`와 `ADMIN` 역할을 구분하여, 관리자 API(`admin/*`)는 관리자 토큰이 없으면 접근을 원천 차단합니다.
- **Token Rotation**: Access Token 만료 시 Refresh Token을 통해 보안을 유지하며 로그인을 연장합니다.

---

## 🚀 백엔드 핵심 로직 (Business Logic Highlights)

### ① 동적 랭킹 시스템 (Dynamic Ranking)
- **로직**: 매일 낮 12시를 기준으로 **최근 7일간의 주문 데이터**를 전수 조사하여 `(판매가 * 수량)`의 총합인 **매출액**을 기준으로 랭킹을 산정합니다.
- **최적화**: 실시간 쿼리 부하를 줄이기 위해 1시간 단위로 통계 테이블에 캐싱하거나, Redis를 활용할 수 있는 구조로 설계되었습니다.

### ② 포인트 시스템 (Point System)
- **적립**: `PURCHASE_COMPLETED` (구매확정) 상태 변경 시 결제 금액의 1%를 자동으로 적립합니다.
- **사용/환불**: 주문 시 차감된 포인트는 주문 취소(`CANCELLED`) 시 자동으로 환불 처리되며, 모든 내역은 `PointHistory` 테이블에 기록되어 추적 가능합니다.

### ③ 이미지 처리 (Image Processing)
- **다중 업로드**: 리뷰 작성 시 여러 장의 이미지를 병렬로 업로드하여 처리 속도를 높였습니다.
- **최적화**: 업로드된 이미지는 리사이징을 거쳐 S3에 저장되며, CDN을 통해 빠르게 제공됩니다.

---

## 📈 향후 개선 계획 (Future Improvements)
1. **MSA 전환 고려**: 주문/결제 모듈과 상품/전시 모듈을 분리하여 트래픽 급증에 유연하게 대응
2. **ELK 스택 도입**: 로그 수집 및 분석을 통해 에러 모니터링 강화
3. **Redis 캐싱 적용**: 메인 페이지의 베스트 셀러 등 조회 빈도가 높은 데이터에 캐싱 적용하여 DB 부하 감소
